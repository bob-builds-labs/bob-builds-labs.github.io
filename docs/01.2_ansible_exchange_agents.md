# This Lab is about Deploying Exchange Agent Exchange Agent(s)

### deploy agents to hosts "exchangehosts"
The example will use the Inventory from the previously create file "hosts.yaml"

If you Skipped the previous lab, create the inventory File by Copying the Code 

```bash
cat <<EOF > hosts.yaml
windows:    # <- a group of Hosts addressed as windows
  children:
    databasehosts:  # <- a group of Hosts addressed as databasehosts
      hosts:
        sql01: # <- an indivisual Host adressed as sql01
        sql02:
          ansible_host: sql02.demo.local # <- an indivisual Host adressed as sql02. resolvable as sql02.demo.local
      vars: # specific Vars for the Group Database Hosts
        app_agent: "{{ msapp_agent_windows }}"
        app_agent_product_id: '{165F48F4-38C4-49DF-904E-4A23D39078BF}'
    filehosts:
      hosts:
        file:
      vars:
        app_agent: "{{ fs_agent_windows }}"
        app_agent_product_id: '{49C974B3-BA72-485C-9A96-794B065339DF}'
    exchangehosts:
      hosts:
        exchange1:
        exchange2:
      vars:
        app_agent: "{{ exchange_agent_windows }}"
        app_agent_product_id: '{165F48F4-38C4-49DF-904E-4A23D39078BF}'
  vars: # -> vars for all Windows Hosts
    ansible_user: administrator
    ansible_password: Password123!
    ansible_winrm_scheme: https
    ansible_winrm_server_cert_validation: ignore
    ansible_shell_type: cmd
    ansible_connection: winrm
EOF

```


### Validate agent hosts Group "exchgangehosts"  ping-able vi winrm

```bash
ansible exchangehosts -m win_ping -i hosts.yaml
```

As we honly want to tackle the host named file, we use the --limit parameter

```bash
ansible-playbook ansible_ppdm/100.3_playbook_copy_and_deploy_windows_agent.yaml -i hosts.yaml --limit exchangehosts, -e ppdm_fqdn=ppdm-1.demo.local -e enable_itempoint=0
```

### View Agent registration Status

```bash
ansible-playbook ansible_ppdm/100.5_get_agent_registration_status.yaml --extra-vars "ppdm_fqdn=ppdm-1.demo.local ppdm_new_password='Password123!'"
```

### Approve Exchange Agents

```bash
ansible-playbook ansible_ppdm/100.4_create_whitelistentry.yaml --extra-vars "ppdm_fqdn=ppdm-1.demo.local ppdm_new_password='Password123!'" -e '{ "host_list" : [ "exchange1.demo.local", "exchange2.demo.local"  ] }'
```

