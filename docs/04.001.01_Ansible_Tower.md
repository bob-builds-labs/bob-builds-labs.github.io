# Ansible Tower / AWX Lab
With this lab, we will use AWX to run ansible Playbooks as AWX Workflows.  
As AWX is not installed in the environment, we will need to do some PreReqs.  

Make sure Openshift is up and running, see Chater 3.0 [openshift lab](./03.0_prepare_openshift_lab.md)  

First of all, we will need to deploy the AWX operator and create an AWX. 
We do so from lab3 folder, as this has the Opnshift Scope set.  

## Update 0499 lab Configuration from Github

```
git -C ~/workspace/0499 pull
```
## Change to lab3 direcory
changing to lab3 directory will load the required variables for lab1

```bash
cd ~/workspace/0499/lab3
direnv allow .
```
## Deploy AWX Operator and create AWX Instance
Deploy the AWX Operator using the below Install Plan:

```bash
oc create ns awx-operator
oc apply -f awx_sub.yaml -n awx-operator

```

Deploy the AWX Instance

```bash
oc apply -f awx.yaml -n awx-operator
```

Deploy the AWX CLI

```bash
python3 -m pip  install awxkit==24.3.1
```

Now check from the UI if your Ansible instance is running using [https://awx-prod-awx-operator.apps.openshift.demo.local/](https://awx-prod-awx-operator.apps.openshift.demo.local/)

You might also use the Openshift Console to check the State.

You can retrieve the Password for the "admin" account using:

```bash
oc get secret/awx-prod-admin-password -n awx-operator -o jsonpath={.data.password} | base64 -d
```


## Setup Minio

Next, we need to setup minio. we do this opn the Ansible Host:

```bash
ansible-playbook playbooks/playbook_deploy_minio.yaml
```


In order to use S3 from ansible, we need to add some Python Libraries

```bash
python3 -m pip install --user botocore boto3
```

the execution environment for AWX will be evaluated from lab2 folder

```bash
cd ~/workspace/0499/lab4
direnv allow .
```



