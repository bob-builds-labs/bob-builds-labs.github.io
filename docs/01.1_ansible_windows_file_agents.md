# Working with windows file Agent
## Prerequisite

Make sure you prepared the environment using [ansible_ppdm_agents](./01.0_ansible_ppdm_agents.md)   
Make sure the "File VM" is started
```bash
govc vm.power -on -vm.ipath="$(govc find / -type m -name file)"
```
it will take a while for the VM to be running. Check it is reachable using win_ping

## Validate agent host "file"  ping-able via winrm

```bash
ansible file -m win_ping -i hosts.yaml
```
once we receive a "pong" the machine is up and reachable for ansible communicationÂ´s
![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/c0b0f729-77e4-4bcb-b01b-bb4f8780a802)

## Installing the File Agent

### deploy agents to host "file"
The example will use the Inventory from the previously create file "hosts.yaml"
As we honly want to tackle the host named file, we use the --limit parameter
*the host lis for limit needs to end with a comma*

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.3_playbook_copy_and_deploy_windows_agent.yaml -i hosts.yaml --limit file, 
```
![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/a4967f07-5010-48a0-9026-386baa92586f)

### View Agent registration Status


![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/9f80cd89-c5c6-4fb3-a77b-f3570c1b4dc5)

The Agent will also be visbile as "Waiting Approval" in the UI

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/46e4bb3d-5fd6-4dde-81a0-b27f3151dfd1)


### Approve File Agent

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.3_create_whitelistentry.yaml -e "host_list=192.168.1.107"
```
![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/60b8ef5b-420b-4f98-a6bf-cd09030ef6f1)


ther agent status should transfer to Approving Certificates

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/234ccecf-e136-43ab-b337-f6777205b993)

And finally to registered:

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/b5d3bf8f-48b9-4462-83ef-ed062291a3d2)

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.5_get_agent_registration_status.yaml
```

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/81bf8058-d474-4eff-aa4c-bdef7965c494)




