# Working with windows file Agent
## Prerequisite

Make sure you prepared the environment using [ansible_ppdm_agents](./01.0_ansible_ppdm_agents.md)   
Make sure the "File VM" is started
```bash
ansible-playbook ~/workspace/playbooks/start_stop_vms_by_vm_names.yaml -e vm_names='file' -e state=start
```
it will take a while for the VM to be running. Check it is reachable using win_ping

## Validate agent host "file"  ping-able via winrm

```bash
ansible filehosts -m win_ping -i hosts.yaml
```
once we receive a "pong" the machine is up and reachable for ansible communication´s
![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/c0b0f729-77e4-4bcb-b01b-bb4f8780a802)

## Installing the File Agent

### deploy agents to host "file"
The example will use the Inventory from the previously create file "hosts.yaml".  
As we only want to tackle the host named file, we use the --limit parameter
*the host list for parameter --limit must end with a comma*

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.3_playbook_copy_and_deploy_windows_agent.yaml -i hosts.yaml --limit filehosts, 
```
![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/a4967f07-5010-48a0-9026-386baa92586f)

### View Agent registration Status

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.5_get_agent_registration_status.yaml
```

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/46e4bb3d-5fd6-4dde-81a0-b27f3151dfd1)

The Agent will also be visbile as "Waiting Approval" in the UI

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/56651410-8737-44cd-b5b6-da7ec7c6e5fc)


### Approve File Agent
as we could see from the Agent registration Status, the Agent´s address is the primary IP Address.  We need to Approve the Host with a whitelist using the primary IP Address.

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.4_create_whitelistentry.yaml -e "host_list=192.168.1.107"
```

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/c0797647-1b12-45a9-8efe-7c4aa917b5d9)


the agent status should transfer to Approving Certificates

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/234ccecf-e136-43ab-b337-f6777205b993)

And finally to registered:

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/b5d3bf8f-48b9-4462-83ef-ed062291a3d2)

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.5_get_agent_registration_status.yaml
```

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/81bf8058-d474-4eff-aa4c-bdef7965c494)




