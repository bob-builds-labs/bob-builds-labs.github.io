# Working with windows file Agent
## Prerequisite

Make sure you prepared the environment using [ansible_ppdm_agents](./01.0_ansible_ppdm_agents.md)   
Make sure the "File VM" is started
```bash
ansible-playbook ../playbooks/start_stop_vms_by_vm_names.yaml -e vm_names='file' -e state=start
```
it will take a while for the VM to be running. Check it is reachable using win_ping

## Validate agent hostgroup "filehosts"  ping-able via winrm

```bash
ansible filehosts -m win_ping -i hosts.yaml
```
once we receive a "pong" the machines are up and reachable for ansible communication´s
![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/68bd0577-16bd-46d2-b95e-33c34b5f0200)


## Installing the File Agent

### deploy agents to hostgroup "filehosts"
The example will use the Inventory from the previously create file "hosts.yaml".  
As we only want to tackle the hostgroup named filehosts, we use the --limit parameter
*the host list for parameter --limit must end with a comma*

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.3_playbook_copy_and_deploy_windows_agent.yaml -i hosts.yaml --limit filehosts, 
```
![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/e0ab7517-be83-4722-89bd-18a3932f2258)


### View Agent registration Status

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.5_get_agent_registration_status.yaml
```

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/96b2e7b0-a322-42e4-8545-503f020cbee8)


The Agent will also be visbile as "Waiting Approval" in the UI

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/c5a7bbe9-bd6f-41de-a582-598fa0bf8948)

### Approve File Agent
as we could see from the Agent registration Status, the Agent´s address is the primary IP Address.  We need to Approve the Host with a whitelist using the primary IP Address.

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.4_create_whitelistentry.yaml -e "host_list=192.168.1.107,192.168.1.2"
```

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/c0797647-1b12-45a9-8efe-7c4aa917b5d9)


the agent status should transfer to Approving Certificates

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/234ccecf-e136-43ab-b337-f6777205b993)

And finally to registered:

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/b5d3bf8f-48b9-4462-83ef-ed062291a3d2)

```bash
ansible-playbook ~/workspace/ansible_ppdm/100.5_get_agent_registration_status.yaml
```

![image](https://github.com/bob-builds-labs/bob-builds-labs.github.io/assets/8255007/81bf8058-d474-4eff-aa4c-bdef7965c494)




