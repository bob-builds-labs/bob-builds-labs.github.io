# AWX Buildup
With this lab, we will deploy Templates, Projects and Worklows to teh AWX Enfirnment, using the AWX CLI  

The execution environment for AWX will be evaluated from lab4 folder

```bash
cd ~/workspace/0499/lab4
direnv allow .
```
## Modify Settings

We use jinja2 native templating in ansible to support PPDM API Enforcement.  
Therefore, we set:

```bash
awx settings modify AWX_TASK_ENV  '{"ANSIBLE_JINJA2_NATIVE": "True"}'
```

## Import Projects

Ansible can Host Project Enfironments on SCM systems. We host our Inventory as well as the ansible_ppdm Modules on Github.  

To import them, we use:

```bash
awx import < 0499.json
awx import < ansible-ppdm.json
```
This should import and sync the 0499 Project containing our Inventory as well the ansible_ppdm roles.


```bash
awx projects list -f human
```

![alt text](image.png)

![alt text](image-1.png)


## Importing the Inventory and the Inventory Source 


```bash
awx import < lab1_inventory.json
awx import < lab1.json
```

```bash
awx inventories list -f human
awx inventory_sources list -f human
```

![alt text](image-3.png)

![alt text](image-2.png)

## Importing the Update Job Templates and Workflow

```bash
awx import < update_templates.json
awx import < workflow_update_ppdm.json
```
![alt text](image-5.png)

![alt text](image-4.png)

![alt text](image-6.png)

## Executing the Update Workflow

First, we need to upload a Package to Minio. We can do from ansible host, or from the Webbrowser just uploading the package  

```bash
ansible-playbook ~/workspace/0499/playbooks/s3_upload.yaml -e "package=dellemc-ppdm-upgrade-sw-19.17.0-5.pkg" -e "local_directory=/home/admin/workspace/0499/lab4" -e "release=19.17"
```

![alt text](image-10.png)


Now, we can execute the Workflow:

![alt text](image-7.png)

![alt text](image-8.png)

![alt text](image-9.png)

![alt text](image-11.png)

![alt text](image-12.png)

Upload and Precheck will be run. The actual Update awaits an Approval ( see Alarm top right ) :  

![alt text](image-15.png)

![alt text](image-13.png)
In case of a failure, mitigate and recheck
![alt text](image-14.png)

Update will take a while, depending on external Components...  

![alt text](image-16.png)
