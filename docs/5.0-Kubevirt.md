# Under Construction for BoB 2025
This Guide outlines the Preparations for the Kubevirt Openshift Lab.  
In the Lab we will utilize the following ressources:  
 - Powerstore-1
 - Openshift
 - Ansible
 - Powerprotect
Make sure the According resources/vApps are started in Advance
## Powerstore prereqs


## configure interfaces for Storage  ons Openshift VmÂ´s / in Openshift Cluster

Make sure the nic 2 on each openshit node is connected and has status to be connected on startup:
![image](https://github.com/user-attachments/assets/647cf2ea-4ac3-4c54-9195-f27da718a80c)

Set ther IP Configuration via ansible from Ansible host
```bash
cd ~/worspace/0499/lab3
git pull
direnv allow .
ansible-playbook ../playbooks/playbook_set_lan2.yaml -i hosts.yaml
```
patch the Network spec for Openshift
```bash
oc patch --type=merge network.operator.openshift.io/cluster \
--patch '{"spec":{"additionalNetworks":[{"name":"backup-lan","namespace":"openshift-host-network","rawCNIConfig":"{\"cniVersion\":\"0.3.1\",\"name\":\"backup-lan\",\"type\":\"host-device\",\"device\":\"ens224\",\"ipam\":{\"type\":\"whereabouts\",\"range\":\"192.168.2.192/27\",\"exclude\":[\"192.168.2.192/32\"]}}","type":"Raw"}]}}'
```

Configure Multipathing for the Openshift Worker Nodes
```bash
oc apply -f mc_multipath.yaml
```
It will take a while for the Machine Config Operator to configure the Nodes with Multipath. each node will be rebooted during this process

configure iscsid ( this will enable iscsi daemin with correct config on hosts )
```bash
oc apply -f mc_iscsid.yaml
```

## Installing on configure Powerstore CSI Modules
the Dell CSM Operator is already installed in the cluster. however, the Container Storage Modules need to be configured for the Required Storage system.
In this section, we will configure CSM for powerstore-1 and powerstore-2

Generate config Secret for Powerstore

```bash
sed "s/CONFIG_YAML/`cat powerstore/config.yaml | base64 -w0`/g" powerstore/secret.yaml | oc apply -f -
```
Create the CSI Drivers for Powerstore

```bash
oc apply -f powerstore/storage_csm_powerstore_v2130.yaml
```
![image](https://github.com/user-attachments/assets/7a209a4a-f7a3-4d23-a03d-bb7713639d60)

Create Storageclasses with Topology support

```bash
oc apply -f powerstore/storageclass-powerstore-1.yaml
oc apply -f powerstore/storageclass-powerstore-2.yaml
oc apply -f powerstore/snapshotclass.yaml
```





```bash
oc apply -f powerstore/demopod.yaml
```
